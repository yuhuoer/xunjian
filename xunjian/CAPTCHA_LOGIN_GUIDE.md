# ğŸ” éªŒè¯ç ç™»å½•æµ‹è¯•å®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†å®Œæ•´çš„éªŒè¯ç ç™»å½•è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆï¼ŒåŒ…æ‹¬OCRè¯†åˆ«ã€å¤šç§é¢„å¤„ç†æ–¹å¼ã€é‡è¯•æœºåˆ¶ç­‰åŠŸèƒ½ã€‚

## ğŸ¯ æµ‹è¯•åœºæ™¯

### 1. **åŸºç¡€éªŒè¯ç ç™»å½•**
- è¾“å…¥ç”¨æˆ·åå¯†ç 
- OCRè¯†åˆ«éªŒè¯ç 
- è‡ªåŠ¨å¡«å…¥å¹¶æäº¤
- éªŒè¯ç™»å½•ç»“æœ

### 2. **å¸¦é‡è¯•æœºåˆ¶çš„ç™»å½•**
- è‡ªåŠ¨é‡è¯•å¤šæ¬¡ï¼ˆæœ€å¤š5æ¬¡ï¼‰
- éªŒè¯ç è¯†åˆ«å¤±è´¥æ—¶è‡ªåŠ¨åˆ·æ–°
- æ™ºèƒ½é”™è¯¯æ£€æµ‹

### 3. **å¤æ‚éªŒè¯ç å¤„ç†**
- å¤šç§å›¾åƒé¢„å¤„ç†æ–¹å¼
- é€‚åº”ä¸åŒéªŒè¯ç æ ·å¼
- iframeä¸­çš„éªŒè¯ç å¤„ç†

## ğŸ“ æµ‹è¯•æ–‡ä»¶è¯´æ˜

### 1. `captcha_test_page.html` - æœ¬åœ°æµ‹è¯•é¡µé¢ â­æ¨è
- **ç‰¹ç‚¹**: å®Œå…¨å¯æ§çš„æµ‹è¯•ç¯å¢ƒ
- **éªŒè¯ç **: 4ä½å­—æ¯æ•°å­—ç»„åˆ
- **ç”¨æˆ·ä¿¡æ¯**: 
  - admin / password123
  - testuser / password123
  - selenium_test / auto_test_123
- **åŠŸèƒ½**: éªŒè¯ç åˆ·æ–°ã€ç™»å½•éªŒè¯ã€ç»“æœæ˜¾ç¤º

### 2. `local_captcha_test.json` - æœ¬åœ°é¡µé¢æµ‹è¯•é…ç½®
- åŸºç¡€OCRè¯†åˆ«æµ‹è¯•
- è‡ªåŠ¨é‡è¯•æœºåˆ¶æµ‹è¯•
- å¤šç§é¢„å¤„ç†æ–¹å¼å¯¹æ¯”

### 3. `captcha_login_test.json` - åœ¨çº¿ç½‘ç«™æµ‹è¯•é…ç½®
- é€‚ç”¨äºå„ç§åœ¨çº¿éªŒè¯ç ç½‘ç«™
- é€šç”¨é€‰æ‹©å™¨é…ç½®
- å®Œæ•´çš„ç™»å½•æµç¨‹

### 4. `real_captcha_sites_test.json` - çœŸå®ç½‘ç«™æµ‹è¯•
- åŒ…å«reCAPTCHAå¤„ç†
- æ‰‹åŠ¨éªŒè¯ç å¤„ç†é€‰é¡¹
- iframeéªŒè¯ç æ”¯æŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. **æµ‹è¯•æœ¬åœ°HTMLé¡µé¢ï¼ˆæ¨èï¼‰**
```bash
# åŸºç¡€æµ‹è¯•
python xunjian/selenium_flow_suite.py --suite xunjian/local_captcha_test.json --default-timeout 30

# æŸ¥çœ‹æˆªå›¾ç»“æœ
ls screenshots/local_*
```

### 2. **æµ‹è¯•åœ¨çº¿ç½‘ç«™**
```bash
# é€šç”¨éªŒè¯ç ç½‘ç«™æµ‹è¯•
python xunjian/selenium_flow_suite.py --suite xunjian/captcha_login_test.json --default-timeout 30

# çœŸå®ç½‘ç«™æµ‹è¯•ï¼ˆåŒ…å«æ‰‹åŠ¨å¤„ç†ï¼‰
python xunjian/selenium_flow_suite.py --suite xunjian/real_captcha_sites_test.json --default-timeout 30
```

## ğŸ”§ OCRé…ç½®è¯¦è§£

### æ”¯æŒçš„é¢„å¤„ç†æ–¹å¼

#### 1. `"default"` - é»˜è®¤å¤„ç†
```json
{
  "action": "ocr_captcha",
  "selector": "#captcha-img",
  "name": "captcha_text",
  "preprocessing": "default"
}
```
- é€‚ç”¨äº: æ¸…æ™°çš„éªŒè¯ç å›¾ç‰‡
- æ•ˆæœ: è½¬ä¸ºç°åº¦å›¾åƒ

#### 2. `"binary"` - äºŒå€¼åŒ–å¤„ç†
```json
{
  "action": "ocr_captcha", 
  "selector": "#captcha-img",
  "name": "captcha_text",
  "preprocessing": "binary"
}
```
- é€‚ç”¨äº: æœ‰èƒŒæ™¯å¹²æ‰°çš„éªŒè¯ç 
- æ•ˆæœ: é»‘ç™½äºŒå€¼åŒ–ï¼Œå»é™¤èƒŒæ™¯

#### 3. `"grayscale"` - ç°åº¦å¤„ç†
```json
{
  "action": "ocr_captcha",
  "selector": "#captcha-img", 
  "name": "captcha_text",
  "preprocessing": "grayscale"
}
```
- é€‚ç”¨äº: å½©è‰²éªŒè¯ç 
- æ•ˆæœ: è½¬ä¸ºç°åº¦å›¾åƒ

#### 4. `"denoise"` - å»å™ªå¤„ç†
```json
{
  "action": "ocr_captcha",
  "selector": "#captcha-img",
  "name": "captcha_text", 
  "preprocessing": "denoise"
}
```
- é€‚ç”¨äº: æœ‰å™ªç‚¹çš„éªŒè¯ç 
- æ•ˆæœ: å»é™¤å›¾åƒå™ªå£°

## ğŸ›ï¸ é«˜çº§åŠŸèƒ½

### 1. **è‡ªåŠ¨è§£å†³éªŒè¯ç ï¼ˆæ¨èï¼‰**
```json
{
  "action": "solve_captcha",
  "captcha_selector": "#captcha-img",
  "input_selector": "#captcha-input",
  "submit_selector": "#submit-btn", 
  "max_attempts": 3,
  "preprocessing": "binary"
}
```

**ä¼˜åŠ¿**:
- è‡ªåŠ¨é‡è¯•æœºåˆ¶
- æ™ºèƒ½é”™è¯¯æ£€æµ‹
- ä¸€æ­¥å®Œæˆæ•´ä¸ªæµç¨‹

### 2. **æ‰‹åŠ¨éªŒè¯ç å¤„ç†**
```json
{
  "action": "wait_user",
  "text": "è¯·æ‰‹åŠ¨å®ŒæˆéªŒè¯ç ï¼Œç„¶åæŒ‰å›è½¦ç»§ç»­...",
  "seconds": 60
}
```

**é€‚ç”¨åœºæ™¯**:
- å¤æ‚çš„å›¾å½¢éªŒè¯ç 
- reCAPTCHAç­‰äº¤äº’å¼éªŒè¯
- OCRè¯†åˆ«ç‡ä½çš„æƒ…å†µ

### 3. **iframeä¸­çš„éªŒè¯ç **
```json
{
  "steps": [
    { "action": "switch_to_frame", "selector": "#captcha-frame" },
    { "action": "ocr_captcha", "selector": ".captcha-img", "name": "code" },
    { "action": "switch_to_default_content" },
    { "action": "type", "selector": "#captcha-input", "text": "${code}" }
  ]
}
```

## ğŸ“Š æµ‹è¯•ç»“æœåˆ†æ

### æˆåŠŸæŒ‡æ ‡
- âœ… éªŒè¯ç æ­£ç¡®è¯†åˆ«
- âœ… ç™»å½•æˆåŠŸé¡µé¢å‡ºç°
- âœ… æ— é”™è¯¯å…³é”®è¯
- âœ… æˆªå›¾æ˜¾ç¤ºæ­£ç¡®çŠ¶æ€

### å¤±è´¥å¤„ç†
- ğŸ”„ è‡ªåŠ¨é‡è¯•æœºåˆ¶
- ğŸ“· ä¿å­˜å¤±è´¥æˆªå›¾
- ğŸ“ è¯¦ç»†é”™è¯¯æ—¥å¿—
- ğŸ” å¤šç§é¢„å¤„ç†å°è¯•

### è°ƒè¯•æŠ€å·§

#### 1. **æŸ¥çœ‹æˆªå›¾åºåˆ—**
```bash
# æŒ‰æ—¶é—´é¡ºåºæŸ¥çœ‹æˆªå›¾
ls -lt screenshots/
```

#### 2. **å¯¹æ¯”ä¸åŒé¢„å¤„ç†æ•ˆæœ**
```json
{
  "steps": [
    { "action": "ocr_captcha", "selector": "#captcha", "name": "result1", "preprocessing": "default" },
    { "action": "ocr_captcha", "selector": "#captcha", "name": "result2", "preprocessing": "binary" },
    { "action": "ocr_captcha", "selector": "#captcha", "name": "result3", "preprocessing": "grayscale" }
  ]
}
```

#### 3. **éªŒè¯ç è¯†åˆ«ç‡æµ‹è¯•**
```bash
# è¿è¡Œå¤šæ¬¡æµ‹è¯•ç»Ÿè®¡æˆåŠŸç‡
for i in {1..10}; do
  python xunjian/selenium_flow_suite.py --suite xunjian/local_captcha_test.json
done
```

## ğŸ›¡ï¸ æœ€ä½³å®è·µ

### 1. **é€‰æ‹©å™¨ç­–ç•¥**
```json
{
  "é€šç”¨éªŒè¯ç é€‰æ‹©å™¨": [
    "#captcha-img",
    ".captcha-image", 
    "img[alt*='captcha']",
    "img[src*='captcha']",
    ".verification-code img"
  ]
}
```

### 2. **é”™è¯¯å¤„ç†ç­–ç•¥**
```json
{
  "steps": [
    { "action": "solve_captcha", "captcha_selector": "#captcha", "input_selector": "#code", "max_attempts": 3 },
    { "action": "assert_page_not_contains", "text": "éªŒè¯ç é”™è¯¯" },
    { "action": "assert_page_not_contains", "text": "ç™»å½•å¤±è´¥" },
    { "action": "check_error_keyword" }
  ]
}
```

### 3. **æ€§èƒ½ä¼˜åŒ–**
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- ä½¿ç”¨æˆªå›¾éªŒè¯å…³é”®æ­¥éª¤
- é¿å…ä¸å¿…è¦çš„ç­‰å¾…

### 4. **å¯ç»´æŠ¤æ€§**
- ä½¿ç”¨å˜é‡å­˜å‚¨å¸¸ç”¨å€¼
- æ¨¡å—åŒ–é…ç½®ä¸åŒç½‘ç«™
- è¯¦ç»†çš„æ­¥éª¤æ³¨é‡Š

## ğŸ” å¸¸è§é—®é¢˜

### Q1: OCRè¯†åˆ«ç‡ä½æ€ä¹ˆåŠï¼Ÿ
**A**: å°è¯•ä¸åŒçš„é¢„å¤„ç†æ–¹å¼ï¼š
1. `binary` - é€‚åˆæœ‰èƒŒæ™¯çš„éªŒè¯ç 
2. `denoise` - é€‚åˆæœ‰å™ªç‚¹çš„éªŒè¯ç   
3. `grayscale` - é€‚åˆå½©è‰²éªŒè¯ç 

### Q2: éªŒè¯ç åœ¨iframeä¸­æ€ä¹ˆå¤„ç†ï¼Ÿ
**A**: ä½¿ç”¨frameåˆ‡æ¢ï¼š
```json
{
  "steps": [
    { "action": "switch_to_frame", "selector": "#frame-id" },
    { "action": "ocr_captcha", "selector": ".captcha" },
    { "action": "switch_to_default_content" }
  ]
}
```

### Q3: å¤æ‚éªŒè¯ç ï¼ˆå¦‚æ‹–æ‹½ã€ç‚¹å‡»ï¼‰æ€ä¹ˆå¤„ç†ï¼Ÿ
**A**: ä½¿ç”¨æ‰‹åŠ¨å¤„ç†æ¨¡å¼ï¼š
```json
{
  "action": "wait_user",
  "text": "è¯·æ‰‹åŠ¨å®ŒæˆéªŒè¯ç ï¼Œå®ŒæˆåæŒ‰å›è½¦",
  "seconds": 120
}
```

### Q4: å¦‚ä½•æé«˜æµ‹è¯•ç¨³å®šæ€§ï¼Ÿ
**A**: 
1. å¢åŠ é‡è¯•æ¬¡æ•°
2. ä½¿ç”¨å¤šç§é¢„å¤„ç†æ–¹å¼
3. æ·»åŠ é€‚å½“çš„ç­‰å¾…æ—¶é—´
4. ä¿å­˜è¯¦ç»†çš„è°ƒè¯•æˆªå›¾

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

### 1. **æ‰¹é‡æµ‹è¯•ä¸åŒç½‘ç«™**
åˆ›å»ºåŒ…å«å¤šä¸ªç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼Œä¸€æ¬¡æ€§æµ‹è¯•å¤šä¸ªéªŒè¯ç ç³»ç»Ÿã€‚

### 2. **éªŒè¯ç è¯†åˆ«ç‡ç»Ÿè®¡**
è®°å½•ä¸åŒé¢„å¤„ç†æ–¹å¼çš„æˆåŠŸç‡ï¼Œä¼˜åŒ–é…ç½®ã€‚

### 3. **è‡ªå®šä¹‰OCRé…ç½®**
æ ¹æ®ç‰¹å®šéªŒè¯ç ç±»å‹è°ƒæ•´OCRå‚æ•°ã€‚

### 4. **é›†æˆåˆ°CI/CD**
å°†éªŒè¯ç æµ‹è¯•é›†æˆåˆ°æŒç»­é›†æˆæµç¨‹ä¸­ã€‚

## ğŸ¯ æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—å’Œæä¾›çš„æµ‹è¯•é…ç½®ï¼Œä½ å¯ä»¥ï¼š

- âœ… æµ‹è¯•å„ç§ç±»å‹çš„éªŒè¯ç ç™»å½•
- âœ… ä½¿ç”¨OCRè‡ªåŠ¨è¯†åˆ«éªŒè¯ç 
- âœ… å¤„ç†å¤æ‚çš„éªŒè¯ç åœºæ™¯
- âœ… å»ºç«‹ç¨³å®šçš„è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

å¼€å§‹æµ‹è¯•å§ï¼ä»æœ¬åœ°HTMLé¡µé¢å¼€å§‹ï¼Œç„¶åé€æ­¥æ‰©å±•åˆ°çœŸå®ç½‘ç«™çš„éªŒè¯ç å¤„ç†ã€‚